var HS_Search,CZRHSParams=CZRHSParams||{};jQuery(function(e){HS_Search=e.extend(CZRHSParams,{searching:!1,cancelled:!1,has_searched:!1,count:0,query:"",timeout:null,wrap:e(".frm_form_fields .helpscout-docs"),form:e(".frm_form_fields .helpscout-docs").closest(".frm-show-form"),field:e(".frm_form_fields .helpscout-docs").find('input[type="text"]'),onclick:"",keypress:"",results:{},performed_search:0,performed_search_list:[],visited_doc_articles:[],has_searched_enough:e.Deferred(function(){var e=this,r=function(){_.delay(function(){HS_Search.performed_search>0?e.resolve():r()},2e4)};return r(),e.promise()}),init:function(){HS_Search.form.find(".go-next-step").hide(),HS_Search.has_searched_enough.done(function(){HS_Search.form.find(".go-next-step").show()}),HS_Search.form.on("keypress",function(r){var a=r.which||r.keyCode;if(HS_Search.field.is(":focus"))return 13!=a||e(r.target).is('textarea,input[type="submit"],input[type="button"]')?void 0:(r.preventDefault(),!1)}),HS_Search.wrap.append('<div class="'+CZRHSParams.template.wrap_class+'" style="display:none;" />'),HS_Search.field.attr("autocomplete","off").on("keydown keyup change",HS_Search.search_changed),HS_Search.wrap.find(".docs-search-wrap").on("click",".docs-search-results .article",function(r){var a=e(this).find(".article--open-original"),s=e(this).find("a[data-beacon-article]").first();if(1==a.length&&1==s.length&&!_.isEmpty(a.attr("href"))&&!_.isEmpty(s.html())){HS_Search.visited_doc_articles.push({title:s.html(),url:a.attr("href")});var t=[];t=_.uniq(HS_Search.visited_doc_articles,function(e){return e.url}),HS_Search.wrap.trigger("new_doc_visited",{doc_links:t})}})},search_changed:function(r){if(!_.isUndefined(r.which)||_.isEmpty(HS_Search.results)){if([9,13,16,17,18,20,32,33,34,37,38,91,93].indexOf(r.which)>-1)HS_Search.log("Ignored key press",r.which);else{HS_Search.log("Starting search countdown in %d ms",parseInt(CZRHSParams.searchDelay,10));var a=e(this);clearTimeout(HS_Search.timeout),HS_Search.timeout=setTimeout(function(){if(HS_Search.log("Performing search",r.which),HS_Search.query=a.val(),HS_Search.query.length<CZRHSParams.minLength||(8===r.which||46===r.which)&&0===HS_Search.query.length)return HS_Search.cancelled=!0,void HS_Search.set_results({});HS_Search.searching||HS_Search.perform_search()},parseInt(CZRHSParams.searchDelay,10))}}},perform_search:function(){HS_Search.results={},HS_Search.cancelled=!1,HS_Search.fetch_results(),HS_Search.performed_search++;var e=_.isEmpty(HS_Search.performed_search_list)?"":_.last(HS_Search.performed_search_list),r=!1;_.isEmpty(e)||(r=e.length<HS_Search.query.length?HS_Search.query.substr(0,e.length)==e:e.substr(0,HS_Search.query.length)==HS_Search.query),r&&HS_Search.performed_search_list.pop(),HS_Search.performed_search_list.push(HS_Search.query),HS_Search.wrap.trigger("new_search_performed",{searches:HS_Search.performed_search_list})},log:function(e,r){HS_Search.debug&&console&&console.log&&console.log(e,r)},get_results_html:function(){var r="",a=0;return void 0!==HS_Search.results.articles&&HS_Search.results.articles.results.length?(HS_Search.form.find(".go-next-step").show(),r=CZRHSParams.template.before,e.each(HS_Search.results.articles.results,function(s,t){var c=!0;CZRHSParams.collections.length>0&&(c=!1,e.each(CZRHSParams.collections,function(e,r){new RegExp("^/docs/"+r).exec(t.docsUrl)&&(c=!0)})),a<HS_Search.limit&&c&&(a++,r+=HS_Search.get_article_html(t))}),r+=CZRHSParams.template.after):4<=HS_Search.performed_search||"resolved"==HS_Search.has_searched_enough.state()?HS_Search.form.find(".go-next-step").show():HS_Search.form.find(".go-next-step").hide(),HS_Search.get_results_found(a)+r},get_article_html:function(e){var r=CZRHSParams.template.item;for(var a in e)e.hasOwnProperty(a)&&(r=r.replace(RegExp("{"+a+"}","g"),e[a]));return r},get_results_found:function(e){var r="",a="results-found";return 0===HS_Search.query.length?(r=CZRHSParams.text.enter_search,a+=" message-enter_search"):HS_Search.query.length<HS_Search.minLength?(r=CZRHSParams.text.not_long_enough.replace("{minLength}",HS_Search.minLength),a+=" message-minlength"):0===e?(r=CZRHSParams.text.no_results_found,a+=" message-no_results"):(r=1===e?CZRHSParams.text.result_found:CZRHSParams.text.results_found,a+=" message-results"),CZRHSParams.template.results_found.replace("{css_class}",a).replace("{text}",r).replace("{count}",e)},set_results:function(e){HS_Search.log("Adding results:",e),HS_Search.results=e,HS_Search.wrap.find(".docs-search-wrap").html(HS_Search.get_results_html()).not(":visible").slideDown()},sanitize_query:function(e){return e=e.replace(/[\{\}\[\]]/g," "),HS_Search.log("Searching for %s",e),e},fetch_results:function(){query=HS_Search.sanitize_query(HS_Search.query),$search_wrap=HS_Search.wrap.find(".docs-search-wrap"),e.ajax({url:"https://"+CZRHSParams._subdomain+".helpscoutdocs.com/search/ajax?ref=support&query="+encodeURIComponent(query),async:!0,dataType:"json",beforeSend:function(){HS_Search.searching=!0,$search_wrap.addClass("docs-searching"),HS_Search.wrap.find(".docs-search-wrap").show().html('<span class="gf-hs-spinner"></span>'),e("body").trigger("gf_hs_search_started")},success:function(r){HS_Search.cancelled||(HS_Search.set_results(r),e("body").trigger("gf_hs_search_results_found"),HS_Search.has_searched=!0)},error:function(r){HS_Search.log("Error: %s",r),e("body").trigger("gf_hs_search_error")}}).always(function(){HS_Search.searching=!1,$search_wrap.removeClass("docs-searching")})}})}),jQuery(function(e){_.delay(function(){HS_Search.init()},300)});